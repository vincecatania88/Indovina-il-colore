<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Gioco dei Colori - Drag & Drop Touch</title>

<style>
body {
    margin: 0;
    font-family: 'Comic Sans MS', cursive, sans-serif;
    background: linear-gradient(135deg, #ffecd2, #fcb69f);
    text-align: center;
    padding-bottom: 40px;
    overflow-x: hidden;
    min-height: 100vh;
}

h1 {
    margin-top: 20px;
    color: #444;
    font-size: clamp(1.5rem, 5vw, 2.5rem);
}

.levels {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
    padding: 10px;
}

.levels button {
    padding: 12px 20px;
    margin: 4px;
    border: none;
    border-radius: 30px;
    font-size: clamp(14px, 4vw, 16px);
    font-weight: bold;
    cursor: pointer;
    background: white;
    transition: all 0.3s;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    touch-action: manipulation;
    min-width: 80px;
}

.levels button:hover {
    transform: scale(1.05);
    background: #f0f0f0;
}

.levels button:active {
    transform: scale(0.95);
}

.game-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 30px;
    margin-top: 20px;
    padding: 0 10px;
}

.colors, .names {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
    width: 100%;
    max-width: 800px;
}

.color-box {
    width: min(80px, 20vw);
    height: min(80px, 20vw);
    border-radius: 20px;
    cursor: pointer;
    box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    transition: transform 0.2s;
    touch-action: none;
    -webkit-tap-highlight-color: transparent;
}

.color-box:active {
    transform: scale(0.95);
}

.color-box.dragging {
    opacity: 0.7;
    transform: scale(0.9);
    position: relative;
    z-index: 1000;
}

.drop-zone {
    width: min(120px, 30vw);
    height: min(100px, 25vw);
    border: 3px dashed #555;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    background: white;
    transition: all 0.3s;
    padding: 10px;
    text-align: center;
    font-size: clamp(12px, 3vw, 14px);
    word-break: break-word;
    touch-action: none;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.drop-zone.filled {
    color: white;
    border: none;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.drop-zone.drop-over {
    transform: scale(1.05);
    border-color: #4CAF50;
    background: rgba(76, 175, 80, 0.1);
}

#message {
    margin-top: 20px;
    font-size: clamp(18px, 5vw, 24px);
    font-weight: bold;
    min-height: 40px;
}

#stars {
    font-size: clamp(24px, 6vw, 32px);
    margin-top: 10px;
    letter-spacing: 5px;
}

canvas {
    position: fixed;
    top: 0;
    left: 0;
    pointer-events: none;
    z-index: 9999;
}

/* Istruzioni per il drag su mobile */
.drag-instruction {
    background: rgba(255,255,255,0.5);
    padding: 8px 15px;
    border-radius: 30px;
    font-size: 14px;
    margin-bottom: 10px;
    display: inline-block;
}

@media (max-width: 600px) {
    .game-container {
        gap: 20px;
    }
    
    .colors, .names {
        gap: 10px;
    }
}
</style>
</head>

<body>

<h1>ðŸŽ¨ Indovina il Colore!</h1>

<div class="levels">
    <button onclick="startGame('facile')">Facile</button>
    <button onclick="startGame('medio')">Medio</button>
    <button onclick="startGame('difficile')">Difficile</button>
    <button onclick="startGame('esperto')">Esperto</button>
    <button onclick="startGame('super')">Super ðŸ”¥</button>
</div>

<div class="drag-instruction">
    ðŸ‘† Premi e trascina i colori sulle parole
</div>

<div class="game-container">
    <div class="colors" id="colors"></div>
    <div class="names" id="names"></div>
</div>

<div id="message"></div>
<div id="stars"></div>

<canvas id="confetti"></canvas>

<script>
const levels = {
    facile: [
        {name: "Rosso", value: "#FF4444"},
        {name: "Blu", value: "#4444FF"},
        {name: "Verde", value: "#44FF44"}
    ],
    medio: [
        {name: "Rosso", value: "#FF4444"},
        {name: "Blu", value: "#4444FF"},
        {name: "Verde", value: "#44FF44"},
        {name: "Giallo", value: "#FFFF44"},
        {name: "Arancione", value: "#FF8844"}
    ],
    difficile: [
        {name: "Ciano", value: "#00FFFF"},
        {name: "Beige", value: "#F5F5DC"},
        {name: "Ocra", value: "#CC7722"},
        {name: "Lilla", value: "#C8A2C8"},
        {name: "Turchese", value: "#40E0D0"},
        {name: "Salmone", value: "#FA8072"},
        {name: "Indaco", value: "#4B0082"}
    ],
    esperto: [
        {name: "Amaranto", value: "#E52B50"},
        {name: "Avorio", value: "#FFFFF0"},
        {name: "Chartreuse", value: "#7FFF00"},
        {name: "Magenta", value: "#FF00FF"},
        {name: "Corallo", value: "#FF7F50"},
        {name: "Verde Smeraldo", value: "#50C878"},
        {name: "Blu Petrolio", value: "#003366"},
        {name: "Grigio Ardesia", value: "#708090"},
        {name: "Ruggine", value: "#B7410E"},
        {name: "Malva", value: "#E0B0FF"}
    ],
    super: [
        {name: "Ceruleo", value: "#2A52BE"},
        {name: "Vermiglio", value: "#E34234"},
        {name: "Zafferano", value: "#F4C430"},
        {name: "Acquamarina", value: "#7FFFD4"},
        {name: "Prugna", value: "#8E4585"},
        {name: "Perla", value: "#EAE0C8"},
        {name: "Topazio", value: "#FFC87C"},
        {name: "Giada", value: "#00A86B"},
        {name: "Cremisi", value: "#DC143C"},
        {name: "Blu Klein", value: "#002FA7"}
    ]
};

let total = 0;
let correct = 0;
let errors = 0;
let draggedElement = null;
let touchOffset = { x: 0, y: 0 };
let isDragging = false;

function startGame(level) {
    // Pulisci tutto
    document.getElementById("colors").innerHTML = "";
    document.getElementById("names").innerHTML = "";
    document.getElementById("message").innerText = "";
    document.getElementById("stars").innerText = "";

    const selected = levels[level];
    total = selected.length;
    correct = 0;
    errors = 0;

    // Mescola le parole
    const shuffled = [...selected].sort(() => Math.random() - 0.5);

    // Crea i colori (in ordine originale)
    selected.forEach(color => {
        const box = createColorElement(color);
        document.getElementById("colors").appendChild(box);
    });

    // Crea le zone di drop (in ordine mescolato)
    shuffled.forEach(color => {
        const drop = createDropZone(color);
        document.getElementById("names").appendChild(drop);
    });
}

function createColorElement(color) {
    const box = document.createElement("div");
    box.classList.add("color-box");
    box.style.backgroundColor = color.value;
    box.dataset.name = color.name;
    box.dataset.color = color.value;

    // Eventi mouse
    box.addEventListener("dragstart", (e) => {
        e.preventDefault();
        return false;
    });
    
    box.addEventListener("mousedown", startDrag);
    
    // Eventi touch
    box.addEventListener("touchstart", handleTouchStart, { passive: false });
    box.addEventListener("touchmove", handleTouchMove, { passive: false });
    box.addEventListener("touchend", handleTouchEnd);
    box.addEventListener("touchcancel", handleTouchEnd);

    return box;
}

function createDropZone(color) {
    const drop = document.createElement("div");
    drop.classList.add("drop-zone");
    drop.innerText = color.name;
    drop.dataset.name = color.name;

    // Eventi mouse
    drop.addEventListener("dragover", (e) => e.preventDefault());
    drop.addEventListener("drop", (e) => {
        e.preventDefault();
        handleDrop(drop);
    });
    
    drop.addEventListener("mouseup", () => handleDrop(drop));
    
    // Eventi touch
    drop.addEventListener("touchend", (e) => {
        e.preventDefault();
        handleDrop(drop);
    });

    return drop;
}

// Gestione drag con mouse
function startDrag(e) {
    e.preventDefault();
    if (isDragging) return;
    
    draggedElement = this;
    this.classList.add("dragging");
    isDragging = true;
}

// Gestione touch
function handleTouchStart(e) {
    e.preventDefault();
    if (isDragging) return;
    
    const touch = e.touches[0];
    const rect = this.getBoundingClientRect();
    
    touchOffset.x = touch.clientX - rect.left;
    touchOffset.y = touch.clientY - rect.top;
    
    draggedElement = this;
    this.classList.add("dragging");
    isDragging = true;
    
    // Crea un elemento fantasma per il feedback visivo
    this.style.position = 'relative';
    this.style.zIndex = '1000';
}

function handleTouchMove(e) {
    e.preventDefault();
    if (!isDragging || !draggedElement) return;
    
    const touch = e.touches[0];
    
    // Evidenzia le zone di drop sotto il dito
    const dropZones = document.querySelectorAll('.drop-zone:not(.filled)');
    let dropOver = false;
    
    dropZones.forEach(zone => {
        const rect = zone.getBoundingClientRect();
        if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
            touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
            zone.classList.add('drop-over');
            dropOver = true;
        } else {
            zone.classList.remove('drop-over');
        }
    });
}

function handleTouchEnd(e) {
    e.preventDefault();
    if (!isDragging || !draggedElement) return;
    
    // Trova la zona di drop sotto il dito
    const touch = e.changedTouches[0];
    const dropZones = document.querySelectorAll('.drop-zone:not(.filled)');
    
    for (let zone of dropZones) {
        const rect = zone.getBoundingClientRect();
        if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
            touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
            handleDrop(zone);
            break;
        }
    }
    
    // Pulisci lo stato di drag
    if (draggedElement) {
        draggedElement.classList.remove("dragging");
        draggedElement.style.position = '';
        draggedElement.style.zIndex = '';
    }
    
    // Rimuovi gli effetti hover
    document.querySelectorAll('.drop-zone').forEach(zone => {
        zone.classList.remove('drop-over');
    });
    
    draggedElement = null;
    isDragging = false;
}

function handleDrop(target) {
    if (!draggedElement) return;

    const draggedName = draggedElement.dataset.name;
    const draggedColor = draggedElement.dataset.color;

    // Verifica se il colore corrisponde alla zona di drop
    if (draggedName === target.dataset.name && !target.classList.contains("filled")) {
        
        // Riempie la zona di drop
        target.style.backgroundColor = draggedColor;
        target.innerText = draggedName;
        target.classList.add("filled");
        
        // Rimuove il colore trascinato
        draggedElement.remove();
        correct++;

        // Verifica se il livello Ã¨ completato
        if (correct === total) {
            showStars();
            launchConfetti();
        }

    } else {
        errors++;
        // Feedback visivo per errore
        target.style.transform = 'scale(0.95)';
        target.style.borderColor = '#FF4444';
        setTimeout(() => {
            target.style.transform = '';
            target.style.borderColor = '';
        }, 200);
    }

    // Pulisci lo stato di drag
    draggedElement.classList.remove("dragging");
    draggedElement = null;
    isDragging = false;
    
    // Rimuovi gli effetti hover
    document.querySelectorAll('.drop-zone').forEach(zone => {
        zone.classList.remove('drop-over');
    });
}

function showStars() {
    let starCount = errors === 0 ? 3 : errors <= 3 ? 2 : 1;
    
    const messages = {
        3: "ðŸŽ‰ PERFETTO! ðŸŒŸðŸŒŸðŸŒŸ",
        2: "ðŸ‘ BRAVO! ðŸŒŸðŸŒŸ",
        1: "ðŸ’ª PUOI FARE MEGLIO! ðŸŒŸ"
    };
    
    document.getElementById("message").innerText = messages[starCount] || "ðŸŽ‰ Livello completato!";
    document.getElementById("stars").innerText = "â­".repeat(starCount);
}

// Confetti migliorato
function launchConfetti() {
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const pieces = [];
    const gravity = 0.15;
    const friction = 0.999;
    const colors = ['#FF4444', '#44FF44', '#4444FF', '#FFFF44', '#FF44FF', '#44FFFF'];

    for (let i = 0; i < 200; i++) {
        pieces.push({
            x: canvas.width / 2 + (Math.random() - 0.5) * 200,
            y: canvas.height / 2 + (Math.random() - 0.5) * 200,
            size: Math.random() * 12 + 4,
            velocityX: (Math.random() - 0.5) * 8,
            velocityY: (Math.random() - 0.5) * 8 - 5,
            rotation: Math.random() * 360,
            rotationSpeed: (Math.random() - 0.5) * 15,
            color: colors[Math.floor(Math.random() * colors.length)],
            shape: Math.random() > 0.5 ? "rect" : "circle"
        });
    }

    let animation;
    let startTime = Date.now();

    function update() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        pieces.forEach(p => {
            p.velocityY += gravity;
            p.velocityX *= friction;
            p.velocityY *= friction;

            p.x += p.velocityX;
            p.y += p.velocityY;
            p.rotation += p.rotationSpeed;

            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rotation * Math.PI / 180);
            ctx.fillStyle = p.color;

            if (p.shape === "rect") {
                ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
            } else {
                ctx.beginPath();
                ctx.arc(0, 0, p.size / 2, 0, Math.PI * 2);
                ctx.fill();
            }

            ctx.restore();
        });

        if (Date.now() - startTime < 3000) {
            animation = requestAnimationFrame(update);
        } else {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
    }

    update();
}

// Previeni il comportamento di default del browser per il drag
document.addEventListener('dragstart', (e) => e.preventDefault());
document.addEventListener('drop', (e) => e.preventDefault());
document.addEventListener('dragover', (e) => e.preventDefault());

// Avvia con livello facile
window.onload = () => startGame('facile');
</script>

</body>
</html>
